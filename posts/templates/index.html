{% extends 'base.html' %}

{% block body %}

  {% for post in posts %}
    {% include '_card.html' %}
  {% endfor %}

  <script>
    const likeButtons = document.querySelectorAll('i.heart')
    likeButtons.forEach((likeButton)=>{
      likeButton.addEventListener('click', (event)=>{
        let postId = event.target.dataset.postId

        likeRequest(event.target, postId)
      })
    })

    let likeRequest = async (button, postId) => {
      console.log(button, postId)

      // django 서버에 요청 보내기
      let likeURL = `/posts/${postId}/like-async/`
      let response = await fetch(likeURL)
      let result = await response.json()

      console.log(result)


      // django 서버의 응답에 따라 버튼 수정
      if (result.status) {
        button.classList.remove('bi-heart')
        button.classList.add('bi-heart-fill')
        button.style.color = 'red'
        button.innerHTML = result.count

      } else {
        button.classList.remove('bi-heart-fill')
        button.classList.add('bi-heart')
        button.style.color = 'black'
        button.innerHTML = result.count
      }
    }
  </script>
  
{% endblock %}